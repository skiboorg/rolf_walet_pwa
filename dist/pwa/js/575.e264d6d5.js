"use strict";(globalThis["webpackChunkrolf_wallet"]=globalThis["webpackChunkrolf_wallet"]||[]).push([[575],{25575:(e,a,l)=>{l.r(a),l.d(a,{default:()=>ta});var t=l(59835),s=l(86970),n=l(60499),o=l(91569),r=l(18910),u=l(23459),i=l(98030),d=l(31655),p=l(87270),c=l(17779);const _=(0,t._)("div",{class:"",style:{height:"50px"}},null,-1),m={key:0},w={key:0},f={key:0,class:"q-mb-md"},g=(0,t._)("p",{class:"text-white caption text-justify"},[(0,t.Uk)("Нажмите эту кпопку при возникновении спорной ситуации. "),(0,t._)("span",{class:"text-bold"},"После нажатия, все действия со сделкой блокируются")],-1),v={key:1},b=(0,t.Uk)("Сделка "),x={class:"text-bold"},U=(0,t.Uk)(" по офферу "),y={class:"text-bold"},h=(0,t.Uk)("  "),k={key:0},S={key:1},z={class:"text-bold"},D=(0,t.Uk)(" по курсу "),q={class:"text-bold"},W=(0,t.Uk)(" на сумму "),C={class:"text-bold"},$=(0,t._)("br",null,null,-1),Q=(0,t._)("br",null,null,-1),H=(0,t.Uk)(" Платежная система: "),Z={class:"text-bold"},V=(0,t.Uk)(", реквизиты: "),A={class:"text-bold"},F=(0,t._)("br",null,null,-1),I=(0,t._)("br",null,null,-1),T=(0,t._)("br",null,null,-1),j={key:2},K=["href"],P=(0,t._)("br",null,null,-1),J={key:3},N=["href"],M=(0,t._)("br",null,null,-1),O={key:0},B={key:0},E=(0,t.Uk)("После нажатия на кнопку согласия, с вашего адреса на адрес гаранта будет снята сумма "),G={class:"text-bold"},L=(0,t.Uk)('. В случае возникновения спорных ситуаций в ходе проведения сделки, нажмите на кнопку "Нужна помощь"'),R={key:1},X=(0,t.Uk)(" У продавца на адрес гаранта будет снята сумма "),Y={class:"text-bold"},ee={key:1},ae=["href"],le={class:"text-bold"},te={key:0},se=(0,t._)("p",{class:"text-caption"},"Добавьте любое подтверждение факта оплаты",-1),ne={key:2},oe={key:0},re=["href"],ue={key:3},ie=["href"],de={class:"text-bold"},pe={key:1},ce=(0,t._)("p",{class:"text-negative text-center items-center"},"Ожидайте подкючения администратора. Сообщения в чате выделены красным цветом",-1),_e=[ce],me={key:2},we=(0,t._)("br",null,null,-1),fe=(0,t._)("br",null,null,-1),ge=(0,t._)("br",null,null,-1),ve=(0,t._)("br",null,null,-1),be=(0,t._)("br",null,null,-1),xe=(0,t._)("br",null,null,-1),Ue=(0,t._)("br",null,null,-1),ye=(0,t.Uk)(" Создатель оффера: "),he=["href"],ke=(0,t._)("br",null,null,-1),Se=(0,t.Uk)(),ze=(0,t._)("br",null,null,-1),De=(0,t.Uk)(" Создатель сделки: "),qe=["href"],We=(0,t._)("br",null,null,-1),Ce={key:0},$e=["href"],Qe={class:"text-bold"},He={key:1},Ze=["href"],Ve={class:"text-bold"},Ae={key:2},Fe=["href"],Ie={key:1},Te=["href"],je={class:"text-bold"},Ke={class:"full-height"},Pe={__name:"Trade",setup(e){const a=(0,r.yj)(),{EraChain:ce}=l(99407),Pe=(0,u.Q)(),Je=(0,d.T)(),Ne=(0,n.iH)(null),Me=(0,n.iH)(null),Oe=(0,n.iH)(null),Be=(0,n.iH)(null),Ee=(0,n.iH)(null),Ge=(0,n.iH)(null),Le=(0,n.iH)(!1),Re=(0,n.iH)(!1),Xe=(0,n.iH)([]),Ye=(0,n.iH)(3e5),ea="7JXmTnbwuDnpqQ3NwxwzhfGgDk223j13eP",aa=(0,t.Fl)((()=>Je.user)),la=(0,t.Fl)((()=>Je.trade)),ta=(0,t.Fl)((()=>la.value.offer.is_sell?la.value.offer.user.wallet===aa.value.wallet:la.value.opponent.wallet===aa.value.wallet));async function sa(){ta.value&&await pa()}async function na(e){let a=null;"money_receive"===e&&(a=la.value.offer.user.wallet!==aa.value.wallet?la.value.offer.user.wallet:la.value.opponent.wallet),c.log(Ee.value),Le.value=!Le.value;let l=new FormData;l.set("action",e),Ee.value&&l.set("file",Ee.value),l.set("wallet",a),l.set("uid",la.value.UID),c.log(l);await(0,o.h)({method:"post",headers:{"content-type":"multipart/form-data"},url:"/api/p2p/trade_action",data:l});Le.value=!Le.value}async function oa(){Ne.value=new WebSocket(`wss://xn--k1affs.xn--p1ai/ws/trade_chat/${la.value.UID}`);const e=await o.h.get(`/api/p2p/get_trade_chat?trade_uid=${la.value.UID}`);c.log(e.data),Xe.value=e.data.messages,Ne.value.onmessage=async e=>{let a=JSON.parse(e.data)["message"];c.log("DATA",a.user.wallet);let l={id:a.id,message:a.message,file:a.file?a.file:null,createdAt:a.createdAt,user:{wallet:a.user.wallet,is_p2p_admin:a.user.is_p2p_admin}};Xe.value.push(l),ua()}}async function ra(e){13===e.keyCode&&Be.value&&await da()}function ua(){Re.value&&(Ge.value.setScrollPosition("vertical",Ye.value,300),Ye.value=20*Math.floor(300))}function ia(){ua()}async function da(){Le.value=!Le.value;let e=new FormData;e.set("message",JSON.stringify(Be.value)),e.set("wallet",aa.value.wallet),e.set("trade_uid",la.value.UID),c.log(e);await(0,o.h)({method:"post",headers:{"content-type":"multipart/form-data"},url:"/api/p2p/add_message_in_trade_chat",data:e});Be.value=null,Ee.value=null,Le.value=!Le.value}async function pa(){Le.value=!Le.value;const e=!0,a=await Pe.getKeyPair(),l=new ce.Type.KeyPair(a),t={assetKey:la.value.offer.asset.key,amount:la.value.asset_amount};c.log(l),c.log(t);const s=await i.era.tranRawSendAsset(l,t,ea,"Заморозка баланса",`Сделка ${la.value.id} по офферу ${la.value.offer.id}`,!1,e);c.log(s),s.error?(0,p.d)("negative",s.error.message):(Me.value=s.fee,Oe.value=s.raw,await ca()),Le.value=!Le.value}async function ca(){const e=await i.era.broadcast64(Oe.value);if(c.log(e),e.error)(0,p.d)("negative",e.message);else{(0,p.d)("positive","Баланс заморожен");await o.h.post("/api/p2p/trade_action",{action:"trade_accept",uid:la.value.UID,tx:e.signature,wallet:aa.value.wallet})}}return(0,t.wF)((async()=>{Je.current_trade_uid=a.params.uid,await Je.get_user(),c.log("wallet",aa.value),await Je.get_trade(),await oa()})),(0,t.Jd)((async()=>{Ne.value?Ne.value.close():c.log("not connect")})),(e,a)=>{const l=(0,t.up)("page-header"),o=(0,t.up)("q-card-section"),r=(0,t.up)("q-card"),u=(0,t.up)("q-btn"),i=(0,t.up)("q-separator"),d=(0,t.up)("q-icon"),p=(0,t.up)("q-file"),c=(0,t.up)("q-chat-message"),ce=(0,t.up)("q-scroll-area"),Pe=(0,t.up)("q-input"),Je=(0,t.up)("q-dialog"),Ne=(0,t.up)("page-body"),Me=(0,t.up)("page"),Oe=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(Me,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Ne,{class:"q-pa-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(l),_,(0,t.Wm)(r,{flat:"",class:(0,s.C_)(["text-bold text-center q-mb-md text-white",`bg-${(0,n.SU)(la).status.color}`])},{default:(0,t.w5)((()=>[(0,t.Wm)(o,null,{default:(0,t.w5)((()=>[(0,t._)("span",null,"Статус сделки: "+(0,s.zw)((0,n.SU)(la).status.label)+" ",1)])),_:1})])),_:1},8,["class"]),(0,n.SU)(la).status.is_declined?((0,t.wg)(),(0,t.iD)("div",Ie,[(0,n.SU)(la).tx_send?((0,t.wg)(),(0,t.iD)("a",{key:0,class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,n.SU)(la).tx_return}&lang=en`,target:"_blank"},[(0,t._)("span",je,"Транзакция возврата "+(0,s.zw)((0,n.SU)(la).asset_amount)+" "+(0,s.zw)((0,n.SU)(la).offer.asset.name),1)],8,Te)):(0,t.kq)("",!0)])):((0,t.wg)(),(0,t.iD)("div",m,[(0,n.SU)(la).status.is_need_help?((0,t.wg)(),(0,t.iD)("div",pe,_e)):((0,t.wg)(),(0,t.iD)("div",w,[(0,n.SU)(la).status.is_default||(0,n.SU)(la).status.is_finished?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",f,[(0,t.Wm)(r,{flat:"",class:"bg-red-4"},{default:(0,t.w5)((()=>[(0,t.Wm)(o,null,{default:(0,t.w5)((()=>[g,(0,t.Wm)(u,{label:"Нужна помощь админа",onClick:a[0]||(a[0]=e=>na("need_help")),class:"full-width","no-caps":"",unelevated:"",color:"yellow-4","text-color":"dark",rounded:""})])),_:1})])),_:1})])),(0,n.SU)(la).status.is_finished?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",v,[(0,t._)("p",null,[b,(0,t._)("span",x,"#"+(0,s.zw)((0,n.SU)(la).id),1),U,(0,t._)("span",y,"#"+(0,s.zw)((0,n.SU)(la).offer.id),1),h,(0,n.SU)(la).offer.is_sell?((0,t.wg)(),(0,t.iD)("span",k,(0,s.zw)((0,n.SU)(la).opponent.wallet===(0,n.SU)(aa).wallet?"покупка":"продажа"),1)):((0,t.wg)(),(0,t.iD)("span",S,(0,s.zw)((0,n.SU)(la).opponent.wallet===(0,n.SU)(aa).wallet?"продажа":"покупка"),1)),(0,t._)("span",z," "+(0,s.zw)((0,n.SU)(la).asset_amount)+" "+(0,s.zw)((0,n.SU)(la).offer.asset.name),1),D,(0,t._)("span",q,(0,s.zw)((0,n.SU)(la).offer.course)+" руб",1),W,(0,t._)("span",C,(0,s.zw)((0,n.SU)(la).fiat_amount)+" руб",1),$,Q,H,(0,t._)("span",Z,(0,s.zw)((0,n.SU)(la).payment_type.label),1),V,(0,t._)("span",A,(0,s.zw)((0,n.SU)(la).payment_type.payment_info),1),F,I,(0,t._)("span",null,(0,s.zw)((0,n.SU)(ta)?"Покупатель":"Продавец"),1),T,(0,n.SU)(la).offer.user.wallet!==(0,n.SU)(aa).wallet?((0,t.wg)(),(0,t.iD)("span",j,[(0,t._)("a",{href:`https://scan.rupay.pro/index/main.html?address=${(0,n.SU)(la).offer.user.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,s.zw)((0,n.SU)(la).offer.user.wallet),9,K),P,(0,t.Uk)(" Завершенных сделок "+(0,s.zw)((0,n.SU)(la).offer.user.total_trades),1)])):((0,t.wg)(),(0,t.iD)("span",J,[(0,t._)("a",{href:`https://scan.rupay.pro/index/main.html?address=${(0,n.SU)(la).opponent.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,s.zw)((0,n.SU)(la).opponent.wallet),9,N),M,(0,t.Uk)(" Завершенных сделок "+(0,s.zw)((0,n.SU)(la).opponent.total_trades),1)]))]),(0,t.Wm)(i,{spaced:"lg"}),(0,n.SU)(la).status.is_default?((0,t.wg)(),(0,t.iD)("div",O,[(0,n.SU)(ta)?((0,t.wg)(),(0,t.iD)("div",B,[(0,t._)("p",null,[E,(0,t._)("span",G,(0,s.zw)((0,n.SU)(la).asset_amount)+" "+(0,s.zw)((0,n.SU)(la).offer.asset.name),1),L]),(0,t.Wm)(u,{loading:Le.value,label:"Согласен на сделку",rounded:"",color:"positive",class:"full-width q-py-md",onClick:sa,unelevated:"","no-caps":""},null,8,["loading"])])):((0,t.wg)(),(0,t.iD)("div",R,[X,(0,t._)("span",Y,(0,s.zw)((0,n.SU)(la).asset_amount)+" "+(0,s.zw)((0,n.SU)(la).offer.asset.name),1)]))])):(0,t.kq)("",!0),(0,n.SU)(la).status.is_active?((0,t.wg)(),(0,t.iD)("div",ee,[(0,t._)("p",null,[(0,t._)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,n.SU)(la).tx}&lang=en`,target:"_blank"},[(0,t._)("span",le,"Транзакция заморозки "+(0,s.zw)((0,n.SU)(la).asset_amount)+" "+(0,s.zw)((0,n.SU)(la).offer.asset.name),1)],8,ae)]),(0,n.SU)(ta)?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",te,[se,(0,t.Wm)(p,{dense:"",outlined:"",rounded:"",label:"Подверждение оплаты",modelValue:Ee.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Ee.value=e),class:"q-mb-md"},{prepend:(0,t.w5)((()=>[(0,t.Wm)(d,{name:"attach_file"})])),_:1},8,["modelValue"]),(0,t.Wm)(u,{loading:Le.value,disable:!Ee.value,label:"Оплату произвел",rounded:"",color:"positive",class:"full-width q-py-md",onClick:a[2]||(a[2]=e=>na("money_send")),unelevated:"","no-caps":""},null,8,["loading","disable"])]))])):(0,t.kq)("",!0),(0,n.SU)(la).status.is_money_sent?((0,t.wg)(),(0,t.iD)("div",ne,[(0,n.SU)(ta)?((0,t.wg)(),(0,t.iD)("div",oe,[(0,t._)("p",null,[(0,t._)("a",{class:"text-primary text-bold",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:(0,n.SU)(la).send_img,target:"_blank"},"Подтверждение оплаты",8,re)]),(0,t.Wm)(u,{loading:Le.value,label:"Оплату получил",rounded:"",color:"positive",class:"full-width q-py-md",onClick:a[3]||(a[3]=e=>na("money_receive")),unelevated:"","no-caps":""},null,8,["loading"])])):(0,t.kq)("",!0)])):(0,t.kq)("",!0),(0,n.SU)(la).status.is_money_recieve?((0,t.wg)(),(0,t.iD)("div",ue,[(0,t._)("p",null,[(0,t._)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,n.SU)(la).tx_send}&lang=en`,target:"_blank"},[(0,t._)("span",de,"Транзакция перевода "+(0,s.zw)((0,n.SU)(la).asset_amount)+" "+(0,s.zw)((0,n.SU)(la).offer.asset.name),1)],8,ie)])])):(0,t.kq)("",!0)]))])),(0,n.SU)(aa).is_p2p_admin?((0,t.wg)(),(0,t.iD)("div",me,[(0,t._)("p",null,[(0,t.Uk)(" Cделка № "+(0,s.zw)((0,n.SU)(la).id),1),we,(0,t.Uk)(" Оффер № "+(0,s.zw)((0,n.SU)(la).offer.id),1),fe,(0,t.Uk)(" Сумма сделки в рублях: "+(0,s.zw)((0,n.SU)(la).fiat_amount),1),ge,(0,t.Uk)(" Сумма сделки в активе: "+(0,s.zw)((0,n.SU)(la).asset_amount)+" "+(0,s.zw)((0,n.SU)(la).offer.asset.name),1),ve,be,(0,t.Uk)(" Тип оффера: "+(0,s.zw)((0,n.SU)(la).offer.is_sell?"продажа":"покупка"),1),xe,Ue,ye,(0,t._)("a",{href:`https://scan.rupay.pro/index/main.html?address=${(0,n.SU)(la).offer.user.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,s.zw)((0,n.SU)(la).offer.user.wallet),9,he),ke,Se,ze,De,(0,t._)("a",{href:`https://scan.rupay.pro/index/main.html?address=${(0,n.SU)(la).opponent.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,s.zw)((0,n.SU)(la).opponent.wallet),9,qe),We]),(0,n.SU)(la).tx?((0,t.wg)(),(0,t.iD)("p",Ce,[(0,t._)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,n.SU)(la).tx}&lang=en`,target:"_blank"},[(0,t._)("span",Qe,"Транзакция заморозки "+(0,s.zw)((0,n.SU)(la).asset_amount)+" "+(0,s.zw)((0,n.SU)(la).offer.asset.name),1)],8,$e)])):(0,t.kq)("",!0),(0,n.SU)(la).tx_send?((0,t.wg)(),(0,t.iD)("p",He,[(0,t._)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,n.SU)(la).tx_send}&lang=en`,target:"_blank"},[(0,t._)("span",Ve,"Транзакция перевода "+(0,s.zw)((0,n.SU)(la).asset_amount)+" "+(0,s.zw)((0,n.SU)(la).offer.asset.name),1)],8,Ze)])):(0,t.kq)("",!0),(0,n.SU)(la).send_img?((0,t.wg)(),(0,t.iD)("p",Ae,[(0,t._)("a",{class:"text-primary text-bold",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:(0,n.SU)(la).send_img,target:"_blank"},"Подтверждение оплаты",8,Fe)])):(0,t.kq)("",!0),(0,t.Wm)(u,{loading:Le.value,label:"Отмена сделки с возвратом замороженного баланса",rounded:"",color:"positive",class:"full-width q-py-md",onClick:a[4]||(a[4]=e=>na("admin_stop")),unelevated:"","no-caps":""},null,8,["loading"])])):(0,t.kq)("",!0)])),(0,t.Wm)(Je,{modelValue:Re.value,"onUpdate:modelValue":a[7]||(a[7]=e=>Re.value=e),seamless:"",position:"bottom",onShow:ia},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{class:"full-width"},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{class:"q-pt-xl"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(u,{class:"absolute-top-right z-max",flat:"",round:"",icon:"close"},null,512),[[Oe]]),(0,t._)("div",Ke,[(0,t.Wm)(ce,{ref_key:"messages_wrapper",ref:Ge,style:{height:"300px"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(Xe.value,(e=>((0,t.wg)(),(0,t.j4)(c,{key:e.id,name:new Date(e.createdAt).toLocaleString(),text:[e.message],sent:e.user.wallet===(0,n.SU)(aa).wallet,"bg-color":e.user.is_p2p_admin?"red-7":e.user.wallet===(0,n.SU)(aa).wallet?"green-3":"grey-3","text-color":e.user.is_p2p_admin?"white":""},null,8,["name","text","sent","bg-color","text-color"])))),128))])),_:1},512),(0,t.Wm)(Pe,{outlined:"",rounded:"",class:"box",loading:Le.value,disable:Le.value,onKeydown:ra,modelValue:Be.value,"onUpdate:modelValue":a[6]||(a[6]=e=>Be.value=e),label:"Ваше сообщение"},{append:(0,t.w5)((()=>[(0,t.Wm)(u,{round:"",dense:"",disable:!Be.value,loading:Le.value,onClick:a[5]||(a[5]=e=>da()),flat:"",icon:"send"},null,8,["disable","loading"])])),_:1},8,["loading","disable","modelValue"])])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(u,{class:"absolute-bottom-right",flat:"",size:"24px",round:"",icon:"las la-comments",onClick:a[8]||(a[8]=e=>Re.value=!0)})])),_:1})])),_:1})}}};var Je=l(44458),Ne=l(63190),Me=l(24455),Oe=l(50926),Be=l(33837),Ee=l(22857),Ge=l(32074),Le=l(66663),Re=l(396),Xe=l(13119),Ye=l(62146),ea=l(69984),aa=l.n(ea);const la=Pe,ta=la;aa()(Pe,"components",{QCard:Je.Z,QCardSection:Ne.Z,QBtn:Me.Z,QSeparator:Oe.Z,QFile:Be.Z,QIcon:Ee.Z,QDialog:Ge.Z,QScrollArea:Le.Z,QChatMessage:Re.Z,QInput:Xe.Z}),aa()(Pe,"directives",{ClosePopup:Ye.Z})}}]);