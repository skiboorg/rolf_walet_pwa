"use strict";(globalThis["webpackChunkrupay_wallet"]=globalThis["webpackChunkrupay_wallet"]||[]).push([[608],{62608:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Z});a(40702),a(84641),a(83269),a(84607),a(25231),a(47725),a(69359),a(56408),a(940),a(13667);var t=a(59835),u=a(60499),s=a(86970),o=a(61957),r=a(99407),n=a(87270),i=a(23459),d=a(46190),m=a(91569),p=(a(98030),a(39981),a(9991)),c=a(17779);const v=(0,t._)("div",{class:"",style:{height:"60px"}},null,-1),g={key:0,class:""},b={class:"flex items-center justify-start q-mb-lg"},h=["src"],w={class:"absolute-bottom-right cursor-pointer",for:"take_img"},y={class:"row items-center justify-end"},_={class:"q-mb-none"},f={class:"q-gutter-sm q-mb-lg"},U={class:"text-center text-weight-medium"},V={key:0,class:"text-center text-weight-medium"},q=["href"],k={__name:"CreatePersonAlt",setup(e){const l=(0,i.Q)(),a=(0,d.c)(),k=(0,u.iH)(null),N=320,W=200,$="image/jpeg",x=1;localStorage.getItem("verify_sent");let z=(0,u.iH)(!1),P=(0,u.iH)(!1),R=(0,u.iH)(null);const C=(0,p.QT)(),Q=(0,u.iH)({firstName:null,lastName:null,middleName:null,birthday:null,gender:0,userPhoto:null,imageUrl:null,passport:null,user_photo:null}),j=((0,u.iH)({amount:"",address:"7R6mzr8YDu1eWiRjBRWyEufz8gL2V9zPmB",title:"Оплата верификации",message:"Оплата верификации",encrypted:!1,fee:0,raw:0}),(0,t.Fl)((()=>!Q.value.firstName||!Q.value.lastName||!Q.value.birthday||!Q.value.userPhoto||!Q.value.passport))),I=((0,t.Fl)((()=>a.balances)),(0,t.Fl)((()=>a.addresses[a.currentAddressIdx].publicKey)),(0,t.Fl)((()=>a.addresses[a.currentAddressIdx].address)));const L=async()=>{let e=k.value.files[0];Q.value.user_photo=e;const l=URL.createObjectURL(e),a=new Image;a.src=l,a.onerror=function(){URL.revokeObjectURL(this.src),c.log("Cannot load image")},a.onload=function(){URL.revokeObjectURL(this.src);const[l,t]=Z(a,N,W),u=document.createElement("canvas");u.width=l,u.height=t;const s=u.getContext("2d");s.drawImage(a,0,0,l,t),u.toBlob((l=>{c.log("Original file",e),c.log("Compressed file",l),l.size>1e6?(0,n.d$)("negative",C.t("img_too_big")):l.size<11e3?(0,n.d$)("negative",C.t("img_too_small")):(Q.value.userPhoto=new File([l],"image.jpg",{type:l.type}),Q.value.imageUrl=URL.createObjectURL(Q.value.userPhoto))}),$,x)}};function Z(e,l,a){let t=e.width,u=e.height;return t>u?t>l&&(u=Math.round(u*l/t),t=l):u>a&&(t=Math.round(t*a/u),u=a),[t,u]}function F(){return Q.value.middleName?Q.value.firstName+" "+Q.value.lastName+" "+Q.value.middleName:Q.value.firstName+" "+Q.value.lastName}const S=async()=>{const e=await l.getKeyPair(),a=new r.EraChain.Type.PublicKeyAccount(e.publicKey),t=new Int8Array(await Q.value.userPhoto.arrayBuffer()),u=await new r.EraChain.Type.PersonHuman(a,F(),new Date(Q.value.birthday).getTime(),new Date(Q.value.birthday).getTime(),Q.value.gender,"",0,0,"","","",0,new Int8Array(0),t,""),s=await u.raw64(e.secretKey);let o=new FormData;o.set("person",JSON.stringify(Q.value)),o.set("user_photo",Q.value.user_photo),o.set("passport",Q.value.passport),o.set("wallet",I.value),o.set("raw",s),c.log(o);await(0,m.h)({method:"post",headers:{"content-type":"multipart/form-data"},url:"/api/settings/new_person",data:o});(0,n.d$)("positive",C.t("wait_verify"))};return(e,l)=>{const a=(0,t.up)("page-header"),r=(0,t.up)("q-icon"),n=(0,t.up)("q-avatar"),i=(0,t.up)("q-input"),d=(0,t.up)("q-btn"),m=(0,t.up)("q-date"),p=(0,t.up)("q-popup-proxy"),c=(0,t.up)("q-radio"),N=(0,t.up)("q-file"),W=(0,t.up)("btn"),$=(0,t.up)("page-body"),x=(0,t.up)("page"),C=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(x,null,{default:(0,t.w5)((()=>[(0,t.Wm)($,{class:"q-px-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(a),v,(0,u.SU)(P)?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",g,[(0,t._)("div",b,[(0,t.Wm)(n,{size:"150px",class:"relative-position q-mr-md"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:Q.value.imageUrl?Q.value.imageUrl:"/noavatar.png",alt:""},null,8,h),(0,t._)("label",w,[(0,t.Wm)(r,{size:"md",color:"white",class:"bg-primary round q-pa-sm",name:"photo_camera"}),(0,t._)("input",{id:"take_img",ref_key:"photo",ref:k,onChange:L,style:{display:"none"},type:"file"},null,544)])])),_:1}),(0,t._)("p",null,(0,s.zw)(e.$t("photo")),1)]),(0,t.Wm)(i,{modelValue:Q.value.firstName,"onUpdate:modelValue":l[0]||(l[0]=e=>Q.value.firstName=e),dense:"",label:e.$t("name"),outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue","label"]),(0,t.Wm)(i,{modelValue:Q.value.lastName,"onUpdate:modelValue":l[1]||(l[1]=e=>Q.value.lastName=e),dense:"",label:e.$t("family"),outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue","label"]),(0,t.Wm)(i,{modelValue:Q.value.middleName,"onUpdate:modelValue":l[2]||(l[2]=e=>Q.value.middleName=e),dense:"",label:e.$t("otch"),outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue","label"]),(0,t.Wm)(i,{label:e.$t("birthday"),outlined:"",clearable:"",dense:"",modelValue:Q.value.birthday,"onUpdate:modelValue":l[4]||(l[4]=e=>Q.value.birthday=e),mask:"date",rules:["date"]},{append:(0,t.w5)((()=>[(0,t.Wm)(r,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:Q.value.birthday,"onUpdate:modelValue":l[3]||(l[3]=e=>Q.value.birthday=e)},{default:(0,t.w5)((()=>[(0,t._)("div",y,[(0,t.wy)((0,t.Wm)(d,{label:e.$t("select"),color:"primary",flat:""},null,8,["label"]),[[C]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["label","modelValue"]),(0,t._)("p",_,(0,s.zw)(e.$t("gender")),1),(0,t._)("div",f,[(0,t.Wm)(c,{modelValue:Q.value.gender,"onUpdate:modelValue":l[5]||(l[5]=e=>Q.value.gender=e),val:0,label:e.$t("gender_m")},null,8,["modelValue","label"]),(0,t.Wm)(c,{modelValue:Q.value.gender,"onUpdate:modelValue":l[6]||(l[6]=e=>Q.value.gender=e),val:1,label:e.$t("gender_f")},null,8,["modelValue","label"])]),(0,t.Wm)(N,{rounded:"",modelValue:Q.value.passport,"onUpdate:modelValue":l[7]||(l[7]=e=>Q.value.passport=e),dense:"",label:e.$t("passport"),outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue","label"]),(0,t.Wm)(W,{label:e.$t("pay_1000"),disabled:(0,u.SU)(j),loading:(0,u.SU)(z),onClick:S,outline:!1},null,8,["label","disabled","loading"])])),(0,t.wy)((0,t._)("div",null,[(0,t._)("p",U,(0,s.zw)(e.$t("wait_verify")),1),(0,u.SU)(R)?((0,t.wg)(),(0,t.iD)("p",V,[(0,t.Uk)((0,s.zw)(e.$t("wait_verify_text1")),1),(0,t._)("a",{style:{},id:"d_link",href:(0,u.SU)(R)},(0,s.zw)(e.$t("wait_verify_text2")),9,q),(0,t.Uk)(" "+(0,s.zw)(e.$t("wait_verify_text3")),1)])):(0,t.kq)("",!0)],512),[[o.F8,(0,u.SU)(P)]])])),_:1})])),_:1})}}};var N=a(61357),W=a(22857),$=a(13119),x=a(52765),z=a(67088),P=a(24455),R=a(11480),C=a(33837),Q=a(62146),j=a(69984),I=a.n(j);const L=k,Z=L;I()(k,"components",{QAvatar:N.Z,QIcon:W.Z,QInput:$.Z,QPopupProxy:x.Z,QDate:z.Z,QBtn:P.Z,QRadio:R.Z,QFile:C.Z}),I()(k,"directives",{ClosePopup:Q.Z})}}]);