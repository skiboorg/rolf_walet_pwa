"use strict";(globalThis["webpackChunkrolf_wallet"]=globalThis["webpackChunkrolf_wallet"]||[]).push([[575],{25575:(e,a,l)=>{l.r(a),l.d(a,{default:()=>sa});var t=l(59835),s=l(60499),n=l(86970),o=l(91569),r=l(18910),u=l(23459),i=l(98030),d=l(31655),p=l(87270),c=l(17779);const m=(0,t._)("div",{class:"",style:{height:"50px"}},null,-1),_={key:0},w={key:1},f={key:0},g={key:0,class:"q-mb-md"},v=(0,t._)("p",{class:"text-white caption text-justify"},[(0,t.Uk)("Нажмите эту кпопку при возникновении спорной ситуации. "),(0,t._)("span",{class:"text-bold"},"После нажатия, все действия со сделкой блокируются")],-1),b={key:1},x=(0,t.Uk)("Сделка "),U={class:"text-bold"},h=(0,t.Uk)(" по офферу "),y={class:"text-bold"},k=(0,t.Uk)("  "),S={key:0},z={key:1},D={class:"text-bold"},q=(0,t.Uk)(" по курсу "),W={class:"text-bold"},C=(0,t.Uk)(" на сумму "),$={class:"text-bold"},Q=(0,t._)("br",null,null,-1),H=(0,t._)("br",null,null,-1),Z=(0,t.Uk)(" Платежная система: "),V={class:"text-bold"},A=(0,t.Uk)(", реквизиты: "),F={class:"text-bold"},I=(0,t._)("br",null,null,-1),T=(0,t._)("br",null,null,-1),j=(0,t._)("br",null,null,-1),K={key:2},P=["href"],J=(0,t._)("br",null,null,-1),N={key:3},M=["href"],O=(0,t._)("br",null,null,-1),B={key:0},E={key:0},G=(0,t.Uk)("После нажатия на кнопку согласия, с вашего адреса на адрес гаранта будет снята сумма "),L={class:"text-bold"},R=(0,t.Uk)('. В случае возникновения спорных ситуаций в ходе проведения сделки, нажмите на кнопку "Нужна помощь"'),X={key:1},Y=(0,t.Uk)(" У продавца на адрес гаранта будет снята сумма "),ee={class:"text-bold"},ae={key:1},le=["href"],te={class:"text-bold"},se={key:0},ne=(0,t._)("p",{class:"text-caption"},"Добавьте любое подтверждение факта оплаты",-1),oe={key:2},re={key:0},ue=["href"],ie={key:3},de=["href"],pe={class:"text-bold"},ce={key:1},me=(0,t._)("p",{class:"text-negative text-center items-center"},"Ожидайте подкючения администратора. Сообщения в чате выделены красным цветом",-1),_e=[me],we={key:2},fe=(0,t._)("br",null,null,-1),ge=(0,t._)("br",null,null,-1),ve=(0,t._)("br",null,null,-1),be=(0,t._)("br",null,null,-1),xe=(0,t._)("br",null,null,-1),Ue=(0,t._)("br",null,null,-1),he=(0,t._)("br",null,null,-1),ye=(0,t.Uk)(" Создатель оффера: "),ke=["href"],Se=(0,t._)("br",null,null,-1),ze=(0,t.Uk)(),De=(0,t._)("br",null,null,-1),qe=(0,t.Uk)(" Создатель сделки: "),We=["href"],Ce=(0,t._)("br",null,null,-1),$e={key:0},Qe=["href"],He={class:"text-bold"},Ze={key:1},Ve=["href"],Ae={class:"text-bold"},Fe={key:2},Ie=["href"],Te={key:2},je=["href"],Ke={class:"text-bold"},Pe={class:"full-height"},Je={__name:"Trade",setup(e){const a=(0,r.yj)(),me=(0,r.tv)(),{EraChain:Je}=l(99407),Ne=(0,u.Q)(),Me=(0,d.T)(),Oe=(0,s.iH)(null),Be=(0,s.iH)(null),Ee=(0,s.iH)(null),Ge=(0,s.iH)(null),Le=(0,s.iH)(null),Re=(0,s.iH)(null),Xe=(0,s.iH)(!1),Ye=(0,s.iH)(!1),ea=(0,s.iH)([]),aa=((0,s.iH)(0),(0,s.iH)(3e5)),la="7JXmTnbwuDnpqQ3NwxwzhfGgDk223j13eP",ta=(0,t.Fl)((()=>Me.user)),sa=(0,t.Fl)((()=>Me.trade)),na=(0,t.Fl)((()=>sa.value.offer.is_sell?sa.value.offer.user.wallet===ta.value.wallet:sa.value.opponent.wallet===ta.value.wallet));async function oa(){na.value&&await ma()}async function ra(e){let a=null;"money_receive"===e&&(a=sa.value.offer.user.wallet!==ta.value.wallet?sa.value.offer.user.wallet:sa.value.opponent.wallet),c.log(Le.value),Xe.value=!Xe.value;let l=new FormData;l.set("action",e),Le.value&&l.set("file",Le.value),l.set("wallet",a),l.set("uid",sa.value.UID),c.log(l);const t=await(0,o.h)({method:"post",headers:{"content-type":"multipart/form-data"},url:"/api/p2p/trade_action",data:l});t.data.success?(0,p.d)("positive",t.data.message):(0,p.d)("negative",t.data.message),Xe.value=!Xe.value,"delete"===e&&me.push({name:"p2p_index"})}async function ua(){Oe.value=new WebSocket(`wss://xn--k1affs.xn--p1ai/ws/trade_chat/${sa.value.UID}`);const e=await o.h.get(`/api/p2p/get_trade_chat?trade_uid=${sa.value.UID}`);c.log(e.data),ea.value=e.data.messages,Oe.value.onmessage=async e=>{let a=JSON.parse(e.data)["message"];c.log("DATA",a.user.wallet);let l={id:a.id,message:a.message,file:a.file?a.file:null,createdAt:a.createdAt,user:{wallet:a.user.wallet,is_p2p_admin:a.user.is_p2p_admin}};ea.value.push(l),da()}}async function ia(e){13===e.keyCode&&Ge.value&&await ca()}function da(){Ye.value&&(Re.value.setScrollPosition("vertical",aa.value,300),aa.value=20*Math.floor(300))}function pa(){da()}async function ca(){Xe.value=!Xe.value;let e=new FormData;e.set("message",JSON.stringify(Ge.value)),e.set("wallet",ta.value.wallet),e.set("trade_uid",sa.value.UID),c.log(e);await(0,o.h)({method:"post",headers:{"content-type":"multipart/form-data"},url:"/api/p2p/add_message_in_trade_chat",data:e});Ge.value=null,Le.value=null,Xe.value=!Xe.value}async function ma(){Xe.value=!Xe.value;const e=!0,a=await Ne.getKeyPair(),l=new Je.Type.KeyPair(a),t={assetKey:sa.value.offer.asset.key,amount:sa.value.asset_amount};c.log(l),c.log(t);const s=await i.era.tranRawSendAsset(l,t,la,"Заморозка баланса",`Сделка ${sa.value.id} по офферу ${sa.value.offer.id}`,!1,e);c.log(s),s.error?(0,p.d)("negative",s.error.message):(Be.value=s.fee,Ee.value=s.raw,await _a()),Xe.value=!Xe.value}async function _a(){const e=await i.era.broadcast64(Ee.value);if(c.log(e),e.error)(0,p.d)("negative",e.message);else{(0,p.d)("positive","Баланс заморожен");await o.h.post("/api/p2p/trade_action",{action:"trade_accept",uid:sa.value.UID,tx:e.signature,wallet:ta.value.wallet})}}return(0,t.wF)((async()=>{Me.current_trade_uid=a.params.uid,await Me.get_user(),c.log("wallet",ta.value),await Me.get_trade(),await ua()})),(0,t.Jd)((async()=>{Oe.value?Oe.value.close():c.log("not connect")})),(e,a)=>{const l=(0,t.up)("page-header"),o=(0,t.up)("q-btn"),r=(0,t.up)("q-card-section"),u=(0,t.up)("q-card"),i=(0,t.up)("q-separator"),d=(0,t.up)("q-icon"),p=(0,t.up)("q-file"),c=(0,t.up)("q-chat-message"),me=(0,t.up)("q-scroll-area"),Je=(0,t.up)("q-input"),Ne=(0,t.up)("q-dialog"),Me=(0,t.up)("page-body"),Oe=(0,t.up)("page"),Be=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(Oe,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Me,{class:"q-pa-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(l),m,(0,s.SU)(sa).status.is_default&&(0,s.SU)(sa).can_delete?((0,t.wg)(),(0,t.iD)("div",_,[(0,t.Wm)(o,{rounded:"",class:"full-width q-mb-md","no-caps":"",unelevated:"",color:"negative",onClick:a[0]||(a[0]=e=>ra("delete")),label:"Отменить сделку"})])):(0,t.kq)("",!0),(0,t.Wm)(u,{flat:"",class:(0,n.C_)(["text-bold text-center q-mb-md text-white",`bg-${(0,s.SU)(sa).status.color}`])},{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t._)("span",null,"Статус сделки: "+(0,n.zw)((0,s.SU)(sa).status.label)+" ",1)])),_:1})])),_:1},8,["class"]),(0,s.SU)(sa).status.is_declined?((0,t.wg)(),(0,t.iD)("div",Te,[(0,s.SU)(sa).tx_send?((0,t.wg)(),(0,t.iD)("a",{key:0,class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,s.SU)(sa).tx_return}&lang=en`,target:"_blank"},[(0,t._)("span",Ke,"Транзакция возврата "+(0,n.zw)((0,s.SU)(sa).asset_amount)+" "+(0,n.zw)((0,s.SU)(sa).offer.asset.name),1)],8,je)):(0,t.kq)("",!0)])):((0,t.wg)(),(0,t.iD)("div",w,[(0,s.SU)(sa).status.is_need_help?((0,t.wg)(),(0,t.iD)("div",ce,_e)):((0,t.wg)(),(0,t.iD)("div",f,[(0,s.SU)(sa).status.is_default||(0,s.SU)(sa).status.is_finished?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",g,[(0,t.Wm)(u,{flat:"",class:"bg-red-4"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[v,(0,t.Wm)(o,{label:"Нужна помощь админа",loading:Xe.value,onClick:a[1]||(a[1]=e=>ra("need_help")),class:"full-width","no-caps":"",unelevated:"",color:"yellow-4","text-color":"dark",rounded:""},null,8,["loading"])])),_:1})])),_:1})])),(0,s.SU)(sa).status.is_finished?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",b,[(0,t._)("p",null,[x,(0,t._)("span",U,"#"+(0,n.zw)((0,s.SU)(sa).id),1),h,(0,t._)("span",y,"#"+(0,n.zw)((0,s.SU)(sa).offer.id),1),k,(0,s.SU)(sa).offer.is_sell?((0,t.wg)(),(0,t.iD)("span",S,(0,n.zw)((0,s.SU)(sa).opponent.wallet===(0,s.SU)(ta).wallet?"покупка":"продажа"),1)):((0,t.wg)(),(0,t.iD)("span",z,(0,n.zw)((0,s.SU)(sa).opponent.wallet===(0,s.SU)(ta).wallet?"продажа":"покупка"),1)),(0,t._)("span",D," "+(0,n.zw)((0,s.SU)(sa).asset_amount)+" "+(0,n.zw)((0,s.SU)(sa).offer.asset.name),1),q,(0,t._)("span",W,(0,n.zw)((0,s.SU)(sa).offer.course)+" руб",1),C,(0,t._)("span",$,(0,n.zw)((0,s.SU)(sa).fiat_amount)+" руб",1),Q,H,Z,(0,t._)("span",V,(0,n.zw)((0,s.SU)(sa).payment_type.label),1),A,(0,t._)("span",F,(0,n.zw)((0,s.SU)(sa).payment_type.payment_info),1),I,T,(0,t._)("span",null,(0,n.zw)((0,s.SU)(na)?"Покупатель":"Продавец"),1),j,(0,s.SU)(sa).offer.user.wallet!==(0,s.SU)(ta).wallet?((0,t.wg)(),(0,t.iD)("span",K,[(0,t._)("a",{href:`https://scan.rupay.pro/index/main.html?address=${(0,s.SU)(sa).offer.user.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,n.zw)((0,s.SU)(sa).offer.user.wallet),9,P),J,(0,t.Uk)(" Завершенных сделок "+(0,n.zw)((0,s.SU)(sa).offer.user.total_trades),1)])):((0,t.wg)(),(0,t.iD)("span",N,[(0,t._)("a",{href:`https://scan.rupay.pro/index/main.html?address=${(0,s.SU)(sa).opponent.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,n.zw)((0,s.SU)(sa).opponent.wallet),9,M),O,(0,t.Uk)(" Завершенных сделок "+(0,n.zw)((0,s.SU)(sa).opponent.total_trades),1)]))]),(0,t.Wm)(i,{spaced:"lg"}),(0,s.SU)(sa).status.is_default?((0,t.wg)(),(0,t.iD)("div",B,[(0,s.SU)(na)?((0,t.wg)(),(0,t.iD)("div",E,[(0,t._)("p",null,[G,(0,t._)("span",L,(0,n.zw)((0,s.SU)(sa).asset_amount)+" "+(0,n.zw)((0,s.SU)(sa).offer.asset.name),1),R]),(0,t.Wm)(o,{loading:Xe.value,label:"Согласен на сделку",rounded:"",color:"positive",class:"full-width q-py-md",onClick:oa,unelevated:"","no-caps":""},null,8,["loading"])])):((0,t.wg)(),(0,t.iD)("div",X,[Y,(0,t._)("span",ee,(0,n.zw)((0,s.SU)(sa).asset_amount)+" "+(0,n.zw)((0,s.SU)(sa).offer.asset.name),1)]))])):(0,t.kq)("",!0),(0,s.SU)(sa).status.is_active?((0,t.wg)(),(0,t.iD)("div",ae,[(0,t._)("p",null,[(0,t._)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,s.SU)(sa).tx}&lang=en`,target:"_blank"},[(0,t._)("span",te,"Транзакция заморозки "+(0,n.zw)((0,s.SU)(sa).asset_amount)+" "+(0,n.zw)((0,s.SU)(sa).offer.asset.name),1)],8,le)]),(0,s.SU)(na)?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",se,[ne,(0,t.Wm)(p,{dense:"",outlined:"",rounded:"",label:"Подверждение оплаты",modelValue:Le.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Le.value=e),class:"q-mb-md"},{prepend:(0,t.w5)((()=>[(0,t.Wm)(d,{name:"attach_file"})])),_:1},8,["modelValue"]),(0,t.Wm)(o,{loading:Xe.value,disable:!Le.value,label:"Оплату произвел",rounded:"",color:"positive",class:"full-width q-py-md",onClick:a[3]||(a[3]=e=>ra("money_send")),unelevated:"","no-caps":""},null,8,["loading","disable"])]))])):(0,t.kq)("",!0),(0,s.SU)(sa).status.is_money_sent?((0,t.wg)(),(0,t.iD)("div",oe,[(0,s.SU)(na)?((0,t.wg)(),(0,t.iD)("div",re,[(0,t._)("p",null,[(0,t._)("a",{class:"text-primary text-bold",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:(0,s.SU)(sa).send_img,target:"_blank"},"Подтверждение оплаты",8,ue)]),(0,t.Wm)(o,{loading:Xe.value,label:"Оплату получил",rounded:"",color:"positive",class:"full-width q-py-md",onClick:a[4]||(a[4]=e=>ra("money_receive")),unelevated:"","no-caps":""},null,8,["loading"])])):(0,t.kq)("",!0)])):(0,t.kq)("",!0),(0,s.SU)(sa).status.is_money_recieve?((0,t.wg)(),(0,t.iD)("div",ie,[(0,t._)("p",null,[(0,t._)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,s.SU)(sa).tx_send}&lang=en`,target:"_blank"},[(0,t._)("span",pe,"Транзакция перевода "+(0,n.zw)((0,s.SU)(sa).asset_amount)+" "+(0,n.zw)((0,s.SU)(sa).offer.asset.name),1)],8,de)])])):(0,t.kq)("",!0)]))])),(0,s.SU)(ta).is_p2p_admin?((0,t.wg)(),(0,t.iD)("div",we,[(0,t._)("p",null,[(0,t.Uk)(" Cделка № "+(0,n.zw)((0,s.SU)(sa).id),1),fe,(0,t.Uk)(" Оффер № "+(0,n.zw)((0,s.SU)(sa).offer.id),1),ge,(0,t.Uk)(" Сумма сделки в рублях: "+(0,n.zw)((0,s.SU)(sa).fiat_amount),1),ve,(0,t.Uk)(" Сумма сделки в активе: "+(0,n.zw)((0,s.SU)(sa).asset_amount)+" "+(0,n.zw)((0,s.SU)(sa).offer.asset.name),1),be,xe,(0,t.Uk)(" Тип оффера: "+(0,n.zw)((0,s.SU)(sa).offer.is_sell?"продажа":"покупка"),1),Ue,he,ye,(0,t._)("a",{href:`https://scan.rupay.pro/index/main.html?address=${(0,s.SU)(sa).offer.user.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,n.zw)((0,s.SU)(sa).offer.user.wallet),9,ke),Se,ze,De,qe,(0,t._)("a",{href:`https://scan.rupay.pro/index/main.html?address=${(0,s.SU)(sa).opponent.wallet}&lang=en`,style:{"text-decoration":"none","border-bottom":"1px dashed"},class:"text-primary text-bold text-caption",target:"_blank"},(0,n.zw)((0,s.SU)(sa).opponent.wallet),9,We),Ce]),(0,s.SU)(sa).tx?((0,t.wg)(),(0,t.iD)("p",$e,[(0,t._)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,s.SU)(sa).tx}&lang=en`,target:"_blank"},[(0,t._)("span",He,"Транзакция заморозки "+(0,n.zw)((0,s.SU)(sa).asset_amount)+" "+(0,n.zw)((0,s.SU)(sa).offer.asset.name),1)],8,Qe)])):(0,t.kq)("",!0),(0,s.SU)(sa).tx_send?((0,t.wg)(),(0,t.iD)("p",Ze,[(0,t._)("a",{class:"text-primary",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:`https://scan.rupay.pro/index/main.html?tx=${(0,s.SU)(sa).tx_send}&lang=en`,target:"_blank"},[(0,t._)("span",Ae,"Транзакция перевода "+(0,n.zw)((0,s.SU)(sa).asset_amount)+" "+(0,n.zw)((0,s.SU)(sa).offer.asset.name),1)],8,Ve)])):(0,t.kq)("",!0),(0,s.SU)(sa).send_img?((0,t.wg)(),(0,t.iD)("p",Fe,[(0,t._)("a",{class:"text-primary text-bold",style:{"text-decoration":"none","border-bottom":"1px dashed"},href:(0,s.SU)(sa).send_img,target:"_blank"},"Подтверждение оплаты",8,Ie)])):(0,t.kq)("",!0),(0,t.Wm)(o,{loading:Xe.value,label:"Отмена сделки с возвратом замороженного баланса",rounded:"",color:"positive",class:"full-width q-py-md",onClick:a[5]||(a[5]=e=>ra("admin_stop")),unelevated:"","no-caps":""},null,8,["loading"])])):(0,t.kq)("",!0)])),(0,t.Wm)(Ne,{modelValue:Ye.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Ye.value=e),seamless:"",position:"bottom",onShow:pa},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{class:"full-width"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{class:"q-pt-xl"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(o,{class:"absolute-top-right z-max",flat:"",round:"",icon:"close"},null,512),[[Be]]),(0,t._)("div",Pe,[(0,t.Wm)(me,{ref_key:"messages_wrapper",ref:Re,style:{height:"300px"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(ea.value,(e=>((0,t.wg)(),(0,t.j4)(c,{key:e.id,name:new Date(e.createdAt).toLocaleString(),text:[e.message],sent:e.user.wallet===(0,s.SU)(ta).wallet,"bg-color":e.user.is_p2p_admin?"red-7":e.user.wallet===(0,s.SU)(ta).wallet?"green-3":"grey-3","text-color":e.user.is_p2p_admin?"white":""},null,8,["name","text","sent","bg-color","text-color"])))),128))])),_:1},512),(0,t.Wm)(Je,{outlined:"",rounded:"",class:"box",loading:Xe.value,disable:Xe.value,onKeydown:ia,modelValue:Ge.value,"onUpdate:modelValue":a[7]||(a[7]=e=>Ge.value=e),label:"Ваше сообщение"},{append:(0,t.w5)((()=>[(0,t.Wm)(o,{round:"",dense:"",disable:!Ge.value,loading:Xe.value,onClick:a[6]||(a[6]=e=>ca()),flat:"",icon:"send"},null,8,["disable","loading"])])),_:1},8,["loading","disable","modelValue"])])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(o,{class:"absolute-bottom-right",flat:"",size:"24px",round:"",icon:"las la-comments",onClick:a[9]||(a[9]=e=>Ye.value=!0)},{default:(0,t.w5)((()=>[ea.value.length>0?((0,t.wg)(),(0,t.j4)(d,{key:0,class:"absolute-top-right",size:"16px",color:"red",name:"priority_high"})):(0,t.kq)("",!0)])),_:1})])),_:1})])),_:1})}}};var Ne=l(24455),Me=l(44458),Oe=l(63190),Be=l(50926),Ee=l(33837),Ge=l(22857),Le=l(32074),Re=l(66663),Xe=l(396),Ye=l(13119),ea=l(62146),aa=l(69984),la=l.n(aa);const ta=Je,sa=ta;la()(Je,"components",{QBtn:Ne.Z,QCard:Me.Z,QCardSection:Oe.Z,QSeparator:Be.Z,QFile:Ee.Z,QIcon:Ge.Z,QDialog:Le.Z,QScrollArea:Re.Z,QChatMessage:Xe.Z,QInput:Ye.Z}),la()(Je,"directives",{ClosePopup:ea.Z})}}]);