"use strict";(globalThis["webpackChunkrolf_wallet"]=globalThis["webpackChunkrolf_wallet"]||[]).push([[783],{6783:(e,a,l)=>{l.r(a),l.d(a,{default:()=>R});l(40702),l(84641),l(83269),l(84607),l(25231),l(47725),l(69359),l(56408),l(940),l(13667);var t=l(59835),n=l(60499),u=l(99407),r=l(87270),o=l(23459),s=l(46190),i=l(17779);const d=(0,t._)("div",{class:"",style:{height:"60px"}},null,-1),m={key:0,class:""},c={class:"flex items-center justify-start q-mb-lg"},p=["src"],v={class:"absolute-bottom-right cursor-pointer",for:"take_img"},g=(0,t._)("p",null,"Фото персоны*",-1),b={class:"row items-center justify-end"},h=(0,t._)("p",{class:"q-mb-none"},"Пол*",-1),y={class:"q-gutter-sm q-mb-lg"},w={key:1},f=(0,t._)("p",{class:"text-center text-weight-medium"},"Ожидайте верификацию",-1),_=[f],U={__name:"CreatePerson",setup(e){const a=(0,o.Q)(),l=(0,s.c)(),f=(0,n.iH)(null),U=320,V=200,q="image/jpeg",x=1;localStorage.getItem("verify_sent");let W=(0,n.iH)(!1),k=(0,n.iH)(!1);const P=(0,n.iH)({firstName:null,lastName:null,birthday:null,gender:0,userPhoto:null,imageUrl:null}),C=(0,t.Fl)((()=>!P.value.firstName||!P.value.lastName||!P.value.birthday||!P.value.userPhoto)),I=((0,t.Fl)((()=>l.addresses[l.currentAddressIdx].publicKey)),(0,t.Fl)((()=>l.addresses[l.currentAddressIdx].address))),N=async()=>{let e=f.value.files[0];const a=URL.createObjectURL(e),l=new Image;l.src=a,l.onerror=function(){URL.revokeObjectURL(this.src),i.log("Cannot load image")},l.onload=function(){URL.revokeObjectURL(this.src);const[a,t]=j(l,U,V),n=document.createElement("canvas");n.width=a,n.height=t;const u=n.getContext("2d");u.drawImage(l,0,0,a,t),n.toBlob((a=>{i.log("Original file",e),i.log("Compressed file",a),a.size<11e3?(0,r.d)("negative","Выберите другое изображение"):(P.value.userPhoto=new File([a],"image.jpg",{type:a.type}),P.value.imageUrl=URL.createObjectURL(P.value.userPhoto))}),q,x)}};function j(e,a,l){let t=e.width,n=e.height;return t>n?t>a&&(n=Math.round(n*a/t),t=a):n>l&&(t=Math.round(t*l/n),n=l),[t,n]}const Q=async()=>{W.value=!W.value;const e=await a.getKeyPair(),l=new u.EraChain.Type.PublicKeyAccount(e.publicKey),t=new Int8Array(await P.value.userPhoto.arrayBuffer()),n=await new u.EraChain.Type.PersonHuman(l,P.value.firstName+" "+P.value.lastName,new Date(P.value.birthday).getTime(),new Date(P.value.birthday).getTime(),P.value.gender,"",0,0,"","","",0,new Int8Array(0),t,""),r=await n.raw64(e.secretKey),o=new Blob([r],{type:"text/plain"}),s=new File([o],`${I.value}.txt`,{type:"text/plain"});i.log(o),W.value=!W.value,await navigator.share({title:"",text:"Мой raw код для верификации",files:[s]}),k.value=!0,localStorage.setItem("verify_sent",!0)};return(e,a)=>{const l=(0,t.up)("page-header"),u=(0,t.up)("q-icon"),r=(0,t.up)("q-avatar"),o=(0,t.up)("q-input"),s=(0,t.up)("q-btn"),i=(0,t.up)("q-date"),U=(0,t.up)("q-popup-proxy"),V=(0,t.up)("q-radio"),q=(0,t.up)("btn"),x=(0,t.up)("page-body"),I=(0,t.up)("page"),j=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(I,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,{class:"q-px-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(l),d,(0,n.SU)(k)?((0,t.wg)(),(0,t.iD)("div",w,_)):((0,t.wg)(),(0,t.iD)("div",m,[(0,t._)("div",c,[(0,t.Wm)(r,{size:"150px",class:"relative-position q-mr-md"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:P.value.imageUrl?P.value.imageUrl:"/noavatar.png",alt:""},null,8,p),(0,t._)("label",v,[(0,t.Wm)(u,{size:"sm",color:"white",class:"bg-primary round q-pa-sm",name:"photo_camera"}),(0,t._)("input",{id:"take_img",ref_key:"photo",ref:f,onChange:N,style:{display:"none"},type:"file"},null,544)])])),_:1}),g]),(0,t.Wm)(o,{modelValue:P.value.firstName,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value.firstName=e),dense:"",label:"Имя*",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(o,{modelValue:P.value.lastName,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value.lastName=e),dense:"",label:"Фамилия *",outlined:"",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),(0,t.Wm)(o,{label:"Дата рождения*",outlined:"",clearable:"",dense:"",modelValue:P.value.birthday,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value.birthday=e),mask:"date",rules:["date"]},{append:(0,t.w5)((()=>[(0,t.Wm)(u,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{modelValue:P.value.birthday,"onUpdate:modelValue":a[2]||(a[2]=e=>P.value.birthday=e)},{default:(0,t.w5)((()=>[(0,t._)("div",b,[(0,t.wy)((0,t.Wm)(s,{label:"Выбрать",color:"primary",flat:""},null,512),[[j]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),h,(0,t._)("div",y,[(0,t.Wm)(V,{modelValue:P.value.gender,"onUpdate:modelValue":a[4]||(a[4]=e=>P.value.gender=e),val:0,label:"Мужской"},null,8,["modelValue"]),(0,t.Wm)(V,{modelValue:P.value.gender,"onUpdate:modelValue":a[5]||(a[5]=e=>P.value.gender=e),val:1,label:"Женский"},null,8,["modelValue"])]),(0,t.Wm)(q,{label:"Добавить персону",disabled:(0,n.SU)(C),loading:(0,n.SU)(W),onClick:Q,outline:!1},null,8,["disabled","loading"])]))])),_:1})])),_:1})}}};var V=l(61357),q=l(22857),x=l(64152),W=l(89133),k=l(67088),P=l(24455),C=l(11480),I=l(62146),N=l(69984),j=l.n(N);const Q=U,R=Q;j()(U,"components",{QAvatar:V.Z,QIcon:q.Z,QInput:x.Z,QPopupProxy:W.Z,QDate:k.Z,QBtn:P.Z,QRadio:C.Z}),j()(U,"directives",{ClosePopup:I.Z})}}]);